"use strict";(wx.webpackJsonp=wx.webpackJsonp||[]).push([[488],{5431:function(a,n,e){var c=e(7842),t=e(1212),s=e(467),r=e(436),o=e(5544),i=e(6540),l=e(118),u=e(758),m=e.n(u),d=e(4848);var p=function(){var a=(0,i.useState)(!1),n=(0,o.A)(a,2),e=n[0],c=n[1],u=(0,i.useState)(0),p=(0,o.A)(u,2),f=p[0],h=p[1],b=(0,i.useState)([]),x=(0,o.A)(b,2),g=x[0],k=x[1],v=function(a){var n=(new Date).toLocaleTimeString();k(function(e){return["[".concat(n,"] ").concat(a)].concat((0,r.A)(e))})},w=function(){var a=(0,s.A)((0,t.A)().m(function a(){var n,e,c;return(0,t.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,v("正在检查数据状态..."),a.n=1,m().cloud.callFunction({name:"import-data",data:{action:"checkStatus"}});case 1:(n=a.v).result.success?(e=n.result.status,v("词汇库: ".concat(e.vocabulary||0,"/").concat(e.vocabularyTotal||0)),v("成语库: ".concat(e.idioms||0,"/").concat(e.idiomsTotal||0)),v("模拟卷题目: ".concat(e.mockExam||0,"/").concat(e.mockExamTotal||0))):v("状态检查失败: ".concat(n.result.message)),a.n=3;break;case 2:a.p=2,c=a.v,v("状态检查异常: ".concat(c.message||c.errMsg));case 3:return a.a(2)}},a,null,[[0,2]])}));return function(){return a.apply(this,arguments)}}(),j=function(){var a=(0,s.A)((0,t.A)().m(function a(){var n,s,r,o,i,l,u,d,p,f;return(0,t.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:if(!e){a.n=1;break}return a.a(2);case 1:return c(!0),h(0),k([]),a.p=2,v("开始导入模拟卷题目..."),a.n=3,m().cloud.callFunction({name:"import-data",data:{action:"getTotal"}});case 3:if(s=a.v,r=(null===(n=s.result.data)||void 0===n?void 0:n.mockExam)||0,v("待导入题目总数: ".concat(r)),0!==r){a.n=4;break}return v("错误: 没有可导入的题目数据"),c(!1),a.a(2);case 4:o=20,i=0,l=0,u=0;case 5:if(!(i<r)){a.n=11;break}return v("正在导入第 ".concat(i+1,"-").concat(Math.min(i+o,r)," 题...")),a.n=6,m().cloud.callFunction({name:"import-data",data:{action:"importBatch",type:"mockExam",startIndex:i,batchSize:o}});case 6:if(d=a.v,!(p=d.result).success){a.n=8;break}if(l+=p.successCount,u+=p.failedCount,i=p.nextIndex||i+o,h(Math.round(i/r*100)),v("成功: ".concat(p.successCount," 条").concat(p.failedCount>0?"，失败: ".concat(p.failedCount," 条"):"")),!p.completed){a.n=7;break}return v("导入完成!"),a.a(3,11);case 7:a.n=9;break;case 8:return v("导入失败: ".concat(p.message)),a.a(3,11);case 9:return a.n=10,new Promise(function(a){return setTimeout(a,500)});case 10:a.n=5;break;case 11:return v("导入完成! 成功: ".concat(l," 条，失败: ").concat(u," 条")),a.n=12,w();case 12:a.n=14;break;case 13:a.p=13,f=a.v,v("导入异常: ".concat(f.message||f.errMsg));case 14:return a.p=14,c(!1),a.f(14);case 15:return a.a(2)}},a,null,[[2,13,14,15]])}));return function(){return a.apply(this,arguments)}}(),A=function(){var a=(0,s.A)((0,t.A)().m(function a(){var n,e;return(0,t.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:return a.n=1,m().showModal({title:"确认清空",content:"确定要清空所有模拟卷题目吗？此操作不可恢复！"});case 1:if(a.v.confirm){a.n=2;break}return a.a(2);case 2:return a.p=2,v("正在清空模拟卷题目..."),a.n=3,m().cloud.callFunction({name:"import-data",data:{action:"clearCollection",collection:"questions_bank"}});case 3:(n=a.v).result.success?v("清空成功，删除了 ".concat(n.result.deleted," 条记录")):v("清空失败: ".concat(n.result.message)),a.n=5;break;case 4:a.p=4,e=a.v,v("清空异常: ".concat(e.message||e.errMsg));case 5:return a.a(2)}},a,null,[[2,4]])}));return function(){return a.apply(this,arguments)}}();return(0,d.jsxs)(l.Ss,{className:"admin-import-page",children:[(0,d.jsx)(l.Ss,{className:"header",children:(0,d.jsx)(l.EY,{className:"title",children:"数据导入管理"})}),(0,d.jsxs)(l.BM,{className:"logs",scrollY:!0,children:[0===g.length&&(0,d.jsx)(l.EY,{className:"empty-log",children:"点击下方按钮开始操作"}),g.map(function(a,n){return(0,d.jsx)(l.EY,{className:"log-item",children:a},n)})]}),f>0&&f<100&&(0,d.jsxs)(l.Ss,{className:"progress-bar",children:[(0,d.jsx)(l.Ss,{className:"progress-fill",style:{width:"".concat(f,"%")}}),(0,d.jsxs)(l.EY,{className:"progress-text",children:[f,"%"]})]}),(0,d.jsxs)(l.Ss,{className:"actions",children:[(0,d.jsx)(l.$n,{className:"btn btn-check",onClick:w,disabled:e,children:"检查状态"}),(0,d.jsx)(l.$n,{className:"btn btn-import",onClick:j,disabled:e,children:e?"导入中...":"导入模拟卷题目"}),(0,d.jsx)(l.$n,{className:"btn btn-clear",onClick:A,disabled:e,children:"清空题目"})]})]})};Page((0,c.createPageConfig)(p,"pages/admin-import/index",{root:{cn:[]}},{}||{}))}},function(a){a.O(0,[907,96],function(){return n=5431,a(a.s=n);var n});a.O()}]);